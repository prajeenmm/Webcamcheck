<!DOCTYPE html>
<html>
<head>
    <title>Webcam Check</title>
    <link href="App_Themes/css/bootstrap.min.css" rel="stylesheet" />
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/WebCam.js" type="text/javascript"></script>
    <script type="text/javascript">
        let $img = null;
        $(function () {
            Webcam.set({
                width: 300,
                height: 220,
                image_format: 'jpeg',
                jpeg_quality: 90
            });
            Webcam.attach('#webcam');
            $("#btnCapture").click(function () {
                Webcam.snap(function (data_uri) {
                    $("#imgCapture")[0].src = data_uri;
                    $("#btnUpload").removeAttr("disabled");
                });
            });
            $("#btnUpload").click(function () {
                var formData = new FormData();
                formData.append("option", "CaptureImages");
                formData.append("type", "upd_photo");
                formData.append("image", $("#imgCapture").attr("src"));
                formData.append("branchid", "27");
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "http://test.innfinitcrs.co.in/WebCheckinApi.aspx", false);
                xhr.addEventListener("load", function (evt) {
                    if (evt.target.status == 200) {
                        var response = JSON.parse(evt.target.response);
                        if (response["FileName"]) {
                            $el.attr("data-image-filename", response["FileName"]);
                        }
                        else {
                            alert("Error Uploading Image");
                        }
                    }
                    else {
                        alert("Error Uploading Image");
                    }
                }, false);
                xhr.addEventListener("error", function (evt) {
                    alert("There was an error attempting to upload the image.");
                }, false);
                xhr.send(formData);
            });
        });
    </script>
    <style>
        .upload-details { text-align: center; }
        .upload-details video { text-align: center; width: 100% !important; height: auto !important; min-width: 100px; min-height: 100px; }
        .live-camera-capture { max-height: 400px; }
        .live-camera-capture video, .live-camera-capture img { width: 300px; height: 220px; }
        #webcam { margin: 0px auto;border:1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="form-group upload-details">
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <b class="d-block">Live Camera</b>
                        <div class="live-camera-capture img-thumbnail">
                            <div id="webcam"></div>
                        </div>
                    </div>
                    <div class="text-center">

                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <b class="d-block">Captured Picture</b>
                        <div class="live-camera-capture img-thumbnail">
                            <img id="imgCapture" class="img-responsive" src="" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <input type="button" id="btnCapture" value="Capture" class="btn btn-primary btn-sm" />
                    <input type="button" id="btnUpload" value="Upload" class="btn btn-primary btn-sm" />
                </div>
            </div>
        </div>
    </div>
</body>
</html>
